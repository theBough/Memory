Public Class Form1
    Dim grid(6, 6) As PictureBox
    Dim di As New IO.DirectoryInfo(CurDir() & "\pics")
    Dim fileArray As IO.FileInfo() = di.GetFiles

    Dim generator As New Random
    Dim numbersUsed(36) As Integer
    Dim indexOfNumbersUsed As Integer = 0

    Dim firstPick As String


    Private Sub btnStart_Click(sender As Object, e As EventArgs) Handles btnStart.Click
        createGrid()
    End Sub

    Sub createGrid()
        Dim counter As Integer = 0
        For x = 0 To 5
            For y = 0 To 5
                grid(x, y) = New PictureBox
                With grid(x, y)
                    .Height = 100
                    .Width = 100
                    .BackColor = Color.Red
                    .Top = y * 105 + 20
                    .Left = x * 105 + 20
                    .Tag = fileArray(getRandomPic()).FullName
                    .SizeMode = PictureBoxSizeMode.StretchImage
                    counter += 1
                End With
                Me.Controls.Add(grid(x, y))
                AddHandler grid(x, y).Click, AddressOf buttonClickEvents
            Next
        Next
    End Sub

    Private Sub Form1_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        For i = 0 To numbersUsed.Length - 1
            numbersUsed(i) = -1
        Next
    End Sub
    Function getRandomPic()
        Dim tempNum As Integer = generator.Next(0, 36)
        For i = 0 To numbersUsed.Length - 1
            If tempNum = numbersUsed(i) Then
                tempNum = generator.Next(0, 36)
                i = -1
            End If
        Next
        numbersUsed(indexOfNumbersUsed) = tempNum
        indexOfNumbersUsed += 1
        Return tempNum
    End Function

    Dim numOfClicks As Integer = 0

    Sub buttonClickEvents(sender As Object, e As EventArgs)
        sender.Image = Image.FromFile(sender.tag)
        getRidofCopy(sender.tag)
        numOfClicks += 1

        If numOfClicks = 2 Then
            Timer1.Start()
            numOfClicks = 0
            toggleAllButtons(False)
            checkForMatch(sender.tag)
        Else
            firstPick = sender.tag
            Me.Text = firstPick
        End If
    End Sub

    Dim counter As Integer = 0
    Private Sub Timer1_Tick(sender As Object, e As EventArgs) Handles Timer1.Tick
        counter += 1
        If counter = 20 Then
            Timer1.Stop()
            counter = 0
            toggleAllButtons(True)
            For x = 0 To 5
                For y = 0 To 5
                    If grid(x, y).Visible Then
                        grid(x, y).Image = Nothing
                    End If

                Next
            Next
        End If
    End Sub

    Sub toggleAllButtons(buttonsOn As Boolean)
        For x = 0 To 5
            For y = 0 To 5
                grid(x, y).Enabled = buttonsOn
            Next
        Next
    End Sub

    Sub checkForMatch(secondPick As String)
        If firstPick = secondPick Then
            For x = 0 To 5
                For y = 0 To 5
                    If grid(x, y).Tag = firstPick Or grid(x, y).Tag = secondPick Then
                        grid(x, y).Hide()
                    End If
                Next
            Next
        End If
    End Sub
    Sub getRidofCopy(pictureName As String)
        Dim isCopy As String = pictureName.Substring(pictureName.Length - 8, 4)
        btnStart.Text = isCopy
    End Sub

End Class
