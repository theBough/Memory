Public Class Form1
    Dim grid(6, 6) As PictureBox
    Dim di As New IO.DirectoryInfo(CurDir() & "\pics")
    Dim fileArray As IO.FileInfo() = di.GetFiles

    Dim generator As New Random
    Dim numbersUsed(36) As Integer
    Dim indexOfNumbersUsed As Integer = 0

    Dim firstPick As String
    Dim secondPick As String
    Dim numOfClicks As Integer = 0
    Dim counter As Integer = 0
    Dim nameWithCopy As String

    Dim aiX As Integer
    Dim aiY As Integer

    Dim whoseTurn As String = "player"
    Private Sub btnStart_Click(sender As Object, e As EventArgs) Handles btnStart.Click
        createGrid()
    End Sub
    Sub createGrid()
        Dim counter As Integer = 0
        For x = 0 To 5
            For y = 0 To 5
                grid(x, y) = New PictureBox
                With grid(x, y)
                    .Height = 100
                    .Width = 100
                    .BackColor = Color.Red
                    .Top = y * 105 + 20
                    .Left = x * 105 + 20
                    .Tag = fileArray(getRandomPic()).FullName
                    .SizeMode = PictureBoxSizeMode.StretchImage
                    counter += 1
                End With
                Me.Controls.Add(grid(x, y))
                AddHandler grid(x, y).Click, AddressOf buttonClickEvents
            Next
        Next
    End Sub
    Private Sub Form1_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        For i = 0 To numbersUsed.Length - 1
            numbersUsed(i) = -1
        Next
    End Sub
    Function getRandomPic()
        Dim tempNum As Integer = generator.Next(0, 36)
        For i = 0 To numbersUsed.Length - 1
            If tempNum = numbersUsed(i) Then
                tempNum = generator.Next(0, 36)
                i = -1
            End If
        Next
        numbersUsed(indexOfNumbersUsed) = tempNum
        indexOfNumbersUsed += 1
        Return tempNum
    End Function
    Sub buttonClickEvents(sender As Object, e As EventArgs)
        sender.Image = Image.FromFile(sender.tag)

        numOfClicks += 1

        If numOfClicks = 2 Then
            Timer1.Start()
            numOfClicks = 0
            toggleAllButtons(False)
            secondPick = getRidofCopy(sender.tag)

        Else
            firstPick = getRidofCopy(sender.tag)
            Me.Text = firstPick
        End If
    End Sub
    Private Sub Timer1_Tick(sender As Object, e As EventArgs) Handles Timer1.Tick
        counter += 1
        If counter = 20 Then
            Timer1.Stop()
            checkForMatch()
            counter = 0
            
            toggleAllButtons(True)
            For x = 0 To 5
                For y = 0 To 5
                    If grid(x, y).Visible Then
                        grid(x, y).Image = Nothing
                    End If

                Next
            Next

            If whoseTurn = "player" Then
                whoseTurn = "ai"
                aiTurn()
            Else
                whoseTurn = "player"
            End If
        End If
    End Sub
    Sub toggleAllButtons(buttonsOn As Boolean)
        For x = 0 To 5
            For y = 0 To 5
                grid(x, y).Enabled = buttonsOn
            Next
        Next
    End Sub
    Sub checkForMatch()
        If firstPick = secondPick Then
            'update the score
            For x = 0 To 5
                For y = 0 To 5
                    If grid(x, y).Tag = firstPick Or grid(x, y).Tag = secondPick Or grid(x, y).Tag = nameWithCopy Then
                        grid(x, y).Hide()
                    End If
                Next
            Next
        End If
    End Sub
    Function getRidofCopy(pictureName As String)
        Dim isCopy As String = pictureName.Substring(pictureName.Length - 8, 4)
        btnStart.Text = isCopy
        If isCopy = "Copy" Then
            nameWithCopy = pictureName
            pictureName = pictureName.Substring(0, pictureName.Length - 11) & ".png"
            Return pictureName
        Else
            Return pictureName
        End If
    End Function

    Sub aiTurn()
        aiX = generator.Next(0, 6)
        aiY = generator.Next(0, 6)
        While Not (grid(aiX, aiY).Visible)
            aiX = generator.Next(0, 6)
            aiY = generator.Next(0, 6)
        End While
        aiClickEvent()

    End Sub

    Sub aiClickEvent()
        grid(aiX, aiY).Image = Image.FromFile(grid(aiX, aiY).Tag)

        numOfClicks += 1

        If numOfClicks = 2 Then
            Timer1.Start()
            numOfClicks = 0
            toggleAllButtons(False)
            secondPick = getRidofCopy(grid(aiX, aiY).Tag)

        Else
            firstPick = getRidofCopy(grid(aiX, aiY).Tag)
            Me.Text = firstPick
            aiTurn()
        End If
    End Sub

End Class
